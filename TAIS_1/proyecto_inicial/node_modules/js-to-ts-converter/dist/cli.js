#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const fs = require("fs");
const ts_simple_ast_1 = require("ts-simple-ast");
const logger_1 = require("./logger");
const js_to_ts_converter_1 = require("./js-to-ts-converter");
const ArgumentParser = require('argparse').ArgumentParser;
const parser = new ArgumentParser({
    version: require('../package.json').version,
    addHelp: true,
    description: 'JS -> TS Converter'
});
parser.addArgument('directory', {
    help: 'The directory of .js files to convert'
});
parser.addArgument('--indentation-text', {
    help: 'How you would like new code to be indented',
    choices: ['tab', 'twospaces', 'fourspaces', 'eightspaces'],
    defaultValue: 'tab'
});
parser.addArgument('--include', {
    help: 'Glob patterns to include in the conversion. Separate multiple patterns ' +
        'with a comma. The patterns must be valid for the "glob-all" npm ' +
        'package (https://www.npmjs.com/package/glob-all), and are relative to ' +
        'the input directory.\n' +
        'Example: --include="**/myFolder/**,**/*.js"'
});
parser.addArgument('--exclude', {
    help: 'Glob patterns to exclude from being converted. Separate multiple patterns ' +
        'with a comma. The patterns must be valid for the "glob-all" npm ' +
        'package (https://www.npmjs.com/package/glob-all), and are relative to ' +
        'the input directory.\n' +
        'Example: --exclude="**/myFolder/**,**/*.jsx"'
});
parser.addArgument('--log-level', {
    help: `
		The level of logs to print to the console. From highest amount of \
		logging to lowest amount of logging: '${logger_1.logLevels.join("', '")}' 
		Defaults to verbose to tell you what's going on, as the script may take
		a long time to complete when looking up usages of functions. Use 'debug'
		to enable even more logging.
	`.trim().replace(/^\t*/gm, ''),
    choices: logger_1.logLevels,
    defaultValue: 'verbose'
});
const args = parser.parseArgs();
const absolutePath = path.resolve(args.directory.replace(/\/$/, '')); // remove any trailing slash
if (!fs.lstatSync(absolutePath).isDirectory()) {
    logger_1.default.error(`${absolutePath} is not a directory. Please provide a directory`);
    process.exit(1);
}
else {
    logger_1.default.info(`Processing directory: '${absolutePath}'`);
}
js_to_ts_converter_1.convertJsToTsSync(absolutePath, {
    indentationText: resolveIndentationText(args.indentation_text),
    logLevel: resolveLogLevel(args.log_level),
    includePatterns: parseIncludePatterns(args.include),
    excludePatterns: parseExcludePatterns(args.exclude)
});
/**
 * Private helper to resolve the correct IndentationText enum from the CLI
 * 'indentation' argument.
 */
function resolveIndentationText(indentationText) {
    switch (indentationText) {
        case 'tab': return ts_simple_ast_1.IndentationText.Tab;
        case 'twospaces': return ts_simple_ast_1.IndentationText.TwoSpaces;
        case 'fourspaces': return ts_simple_ast_1.IndentationText.FourSpaces;
        case 'eightspaces': return ts_simple_ast_1.IndentationText.EightSpaces;
        default: return ts_simple_ast_1.IndentationText.Tab;
    }
}
function resolveLogLevel(logLevelStr) {
    if (!logger_1.logLevels.includes(logLevelStr)) {
        throw new Error(`
			Unknown --log-level argument '${logLevelStr}'
			Must be one of: '${logger_1.logLevels.join("', '")}'
		`.trim().replace(/\t*/gm, ''));
    }
    return logLevelStr;
}
function parseIncludePatterns(includePatterns) {
    if (!includePatterns) {
        return undefined;
    } // return undefined to use the default
    return includePatterns.split(',');
}
function parseExcludePatterns(excludePatterns) {
    if (!excludePatterns) {
        return [];
    }
    return excludePatterns.split(',');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSw2QkFBNkI7QUFDN0IseUJBQXlCO0FBRXpCLGlEQUFnRDtBQUNoRCxxQ0FBdUQ7QUFDdkQsNkRBQXlEO0FBR3pELE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxjQUFjLENBQUM7QUFDMUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxjQUFjLENBQUU7SUFDbEMsT0FBTyxFQUFFLE9BQU8sQ0FBRSxpQkFBaUIsQ0FBRSxDQUFDLE9BQU87SUFDN0MsT0FBTyxFQUFFLElBQUk7SUFDYixXQUFXLEVBQUUsb0JBQW9CO0NBQ2pDLENBQUUsQ0FBQztBQUNKLE1BQU0sQ0FBQyxXQUFXLENBQUUsV0FBVyxFQUFFO0lBQ2hDLElBQUksRUFBRSx1Q0FBdUM7Q0FDN0MsQ0FBRSxDQUFDO0FBQ0osTUFBTSxDQUFDLFdBQVcsQ0FBRSxvQkFBb0IsRUFBRTtJQUN6QyxJQUFJLEVBQUUsNENBQTRDO0lBQ2xELE9BQU8sRUFBRSxDQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLGFBQWEsQ0FBRTtJQUM1RCxZQUFZLEVBQUUsS0FBSztDQUNuQixDQUFFLENBQUM7QUFDSixNQUFNLENBQUMsV0FBVyxDQUFFLFdBQVcsRUFBRTtJQUNoQyxJQUFJLEVBQUUseUVBQXlFO1FBQ3pFLGtFQUFrRTtRQUNsRSx3RUFBd0U7UUFDeEUsd0JBQXdCO1FBQ3hCLDZDQUE2QztDQUNuRCxDQUFFLENBQUM7QUFDSixNQUFNLENBQUMsV0FBVyxDQUFFLFdBQVcsRUFBRTtJQUNoQyxJQUFJLEVBQUUsNEVBQTRFO1FBQzVFLGtFQUFrRTtRQUNsRSx3RUFBd0U7UUFDeEUsd0JBQXdCO1FBQ3hCLDhDQUE4QztDQUNwRCxDQUFFLENBQUM7QUFDSixNQUFNLENBQUMsV0FBVyxDQUFFLGFBQWEsRUFBRTtJQUNsQyxJQUFJLEVBQUU7OzBDQUVtQyxrQkFBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7Ozs7RUFJOUQsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBRTtJQUNoQyxPQUFPLEVBQUUsa0JBQVM7SUFDbEIsWUFBWSxFQUFFLFNBQVM7Q0FDdkIsQ0FBRSxDQUFDO0FBRUosTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO0FBQ2hDLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBRSxDQUFFLENBQUMsQ0FBRSw0QkFBNEI7QUFHdkcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUUsWUFBWSxDQUFFLENBQUMsV0FBVyxFQUFFLEVBQUc7SUFDakQsZ0JBQU0sQ0FBQyxLQUFLLENBQUUsR0FBRyxZQUFZLGlEQUFpRCxDQUFFLENBQUM7SUFDakYsT0FBTyxDQUFDLElBQUksQ0FBRSxDQUFDLENBQUUsQ0FBQztDQUNsQjtLQUFNO0lBQ04sZ0JBQU0sQ0FBQyxJQUFJLENBQUUsMEJBQTBCLFlBQVksR0FBRyxDQUFFLENBQUM7Q0FDekQ7QUFHRCxzQ0FBaUIsQ0FBRSxZQUFZLEVBQUU7SUFDaEMsZUFBZSxFQUFFLHNCQUFzQixDQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBRTtJQUNoRSxRQUFRLEVBQUUsZUFBZSxDQUFFLElBQUksQ0FBQyxTQUFTLENBQUU7SUFDM0MsZUFBZSxFQUFFLG9CQUFvQixDQUFFLElBQUksQ0FBQyxPQUFPLENBQUU7SUFDckQsZUFBZSxFQUFFLG9CQUFvQixDQUFFLElBQUksQ0FBQyxPQUFPLENBQUU7Q0FDckQsQ0FBRSxDQUFDO0FBR0o7OztHQUdHO0FBQ0gsZ0NBQWlDLGVBQW1FO0lBQ25HLFFBQVEsZUFBZSxFQUFHO1FBQ3pCLEtBQUssS0FBYyxDQUFDLENBQUMsT0FBTywrQkFBZSxDQUFDLEdBQUcsQ0FBQztRQUNoRCxLQUFLLFdBQWMsQ0FBQyxDQUFDLE9BQU8sK0JBQWUsQ0FBQyxTQUFTLENBQUM7UUFDdEQsS0FBSyxZQUFjLENBQUMsQ0FBQyxPQUFPLCtCQUFlLENBQUMsVUFBVSxDQUFDO1FBQ3ZELEtBQUssYUFBYyxDQUFDLENBQUMsT0FBTywrQkFBZSxDQUFDLFdBQVcsQ0FBQztRQUV4RCxPQUFRLENBQUMsQ0FBQyxPQUFPLCtCQUFlLENBQUMsR0FBRyxDQUFDO0tBQ3JDO0FBQ0YsQ0FBQztBQUdELHlCQUEwQixXQUFtQjtJQUM1QyxJQUFJLENBQUMsa0JBQVMsQ0FBQyxRQUFRLENBQUUsV0FBVyxDQUFFLEVBQUc7UUFDeEMsTUFBTSxJQUFJLEtBQUssQ0FBRTttQ0FDZ0IsV0FBVztzQkFDeEIsa0JBQVMsQ0FBQyxJQUFJLENBQUUsTUFBTSxDQUFFO0dBQzNDLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFFLE9BQU8sRUFBRSxFQUFFLENBQUUsQ0FBRSxDQUFDO0tBQ2xDO0lBRUQsT0FBTyxXQUF1QixDQUFDO0FBQ2hDLENBQUM7QUFHRCw4QkFBK0IsZUFBbUM7SUFDakUsSUFBSSxDQUFDLGVBQWUsRUFBRztRQUFFLE9BQU8sU0FBUyxDQUFDO0tBQUUsQ0FBRSxzQ0FBc0M7SUFFcEYsT0FBTyxlQUFlLENBQUMsS0FBSyxDQUFFLEdBQUcsQ0FBRSxDQUFDO0FBQ3JDLENBQUM7QUFFRCw4QkFBK0IsZUFBbUM7SUFDakUsSUFBSSxDQUFDLGVBQWUsRUFBRztRQUFFLE9BQU8sRUFBRSxDQUFDO0tBQUU7SUFFckMsT0FBTyxlQUFlLENBQUMsS0FBSyxDQUFFLEdBQUcsQ0FBRSxDQUFDO0FBQ3JDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5cbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxuaW1wb3J0IHsgSW5kZW50YXRpb25UZXh0IH0gZnJvbSBcInRzLXNpbXBsZS1hc3RcIjtcbmltcG9ydCBsb2dnZXIsIHsgTG9nTGV2ZWwsIGxvZ0xldmVscyB9IGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGNvbnZlcnRKc1RvVHNTeW5jIH0gZnJvbSBcIi4vanMtdG8tdHMtY29udmVydGVyXCI7XG5cblxuY29uc3QgQXJndW1lbnRQYXJzZXIgPSByZXF1aXJlKCdhcmdwYXJzZScpLkFyZ3VtZW50UGFyc2VyO1xuY29uc3QgcGFyc2VyID0gbmV3IEFyZ3VtZW50UGFyc2VyKCB7XG5cdHZlcnNpb246IHJlcXVpcmUoICcuLi9wYWNrYWdlLmpzb24nICkudmVyc2lvbixcblx0YWRkSGVscDogdHJ1ZSxcblx0ZGVzY3JpcHRpb246ICdKUyAtPiBUUyBDb252ZXJ0ZXInXG59ICk7XG5wYXJzZXIuYWRkQXJndW1lbnQoICdkaXJlY3RvcnknLCB7XG5cdGhlbHA6ICdUaGUgZGlyZWN0b3J5IG9mIC5qcyBmaWxlcyB0byBjb252ZXJ0J1xufSApO1xucGFyc2VyLmFkZEFyZ3VtZW50KCAnLS1pbmRlbnRhdGlvbi10ZXh0Jywge1xuXHRoZWxwOiAnSG93IHlvdSB3b3VsZCBsaWtlIG5ldyBjb2RlIHRvIGJlIGluZGVudGVkJyxcblx0Y2hvaWNlczogWyAndGFiJywgJ3R3b3NwYWNlcycsICdmb3Vyc3BhY2VzJywgJ2VpZ2h0c3BhY2VzJyBdLFxuXHRkZWZhdWx0VmFsdWU6ICd0YWInXG59ICk7XG5wYXJzZXIuYWRkQXJndW1lbnQoICctLWluY2x1ZGUnLCB7XG5cdGhlbHA6ICdHbG9iIHBhdHRlcm5zIHRvIGluY2x1ZGUgaW4gdGhlIGNvbnZlcnNpb24uIFNlcGFyYXRlIG11bHRpcGxlIHBhdHRlcm5zICcgK1xuXHQgICAgICAnd2l0aCBhIGNvbW1hLiBUaGUgcGF0dGVybnMgbXVzdCBiZSB2YWxpZCBmb3IgdGhlIFwiZ2xvYi1hbGxcIiBucG0gJyArXG5cdCAgICAgICdwYWNrYWdlIChodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9nbG9iLWFsbCksIGFuZCBhcmUgcmVsYXRpdmUgdG8gJyArXG5cdCAgICAgICd0aGUgaW5wdXQgZGlyZWN0b3J5LlxcbicgK1xuXHQgICAgICAnRXhhbXBsZTogLS1pbmNsdWRlPVwiKiovbXlGb2xkZXIvKiosKiovKi5qc1wiJ1xufSApO1xucGFyc2VyLmFkZEFyZ3VtZW50KCAnLS1leGNsdWRlJywge1xuXHRoZWxwOiAnR2xvYiBwYXR0ZXJucyB0byBleGNsdWRlIGZyb20gYmVpbmcgY29udmVydGVkLiBTZXBhcmF0ZSBtdWx0aXBsZSBwYXR0ZXJucyAnICtcblx0ICAgICAgJ3dpdGggYSBjb21tYS4gVGhlIHBhdHRlcm5zIG11c3QgYmUgdmFsaWQgZm9yIHRoZSBcImdsb2ItYWxsXCIgbnBtICcgK1xuXHQgICAgICAncGFja2FnZSAoaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZ2xvYi1hbGwpLCBhbmQgYXJlIHJlbGF0aXZlIHRvICcgK1xuXHQgICAgICAndGhlIGlucHV0IGRpcmVjdG9yeS5cXG4nICtcblx0ICAgICAgJ0V4YW1wbGU6IC0tZXhjbHVkZT1cIioqL215Rm9sZGVyLyoqLCoqLyouanN4XCInXG59ICk7XG5wYXJzZXIuYWRkQXJndW1lbnQoICctLWxvZy1sZXZlbCcsIHtcblx0aGVscDogYFxuXHRcdFRoZSBsZXZlbCBvZiBsb2dzIHRvIHByaW50IHRvIHRoZSBjb25zb2xlLiBGcm9tIGhpZ2hlc3QgYW1vdW50IG9mIFxcXG5cdFx0bG9nZ2luZyB0byBsb3dlc3QgYW1vdW50IG9mIGxvZ2dpbmc6ICcke2xvZ0xldmVscy5qb2luKFwiJywgJ1wiKX0nIFxuXHRcdERlZmF1bHRzIHRvIHZlcmJvc2UgdG8gdGVsbCB5b3Ugd2hhdCdzIGdvaW5nIG9uLCBhcyB0aGUgc2NyaXB0IG1heSB0YWtlXG5cdFx0YSBsb25nIHRpbWUgdG8gY29tcGxldGUgd2hlbiBsb29raW5nIHVwIHVzYWdlcyBvZiBmdW5jdGlvbnMuIFVzZSAnZGVidWcnXG5cdFx0dG8gZW5hYmxlIGV2ZW4gbW9yZSBsb2dnaW5nLlxuXHRgLnRyaW0oKS5yZXBsYWNlKCAvXlxcdCovZ20sICcnICksXG5cdGNob2ljZXM6IGxvZ0xldmVscyxcblx0ZGVmYXVsdFZhbHVlOiAndmVyYm9zZSdcbn0gKTtcblxuY29uc3QgYXJncyA9IHBhcnNlci5wYXJzZUFyZ3MoKTtcbmNvbnN0IGFic29sdXRlUGF0aCA9IHBhdGgucmVzb2x2ZSggYXJncy5kaXJlY3RvcnkucmVwbGFjZSggL1xcLyQvLCAnJyApICk7ICAvLyByZW1vdmUgYW55IHRyYWlsaW5nIHNsYXNoXG5cblxuaWYoICFmcy5sc3RhdFN5bmMoIGFic29sdXRlUGF0aCApLmlzRGlyZWN0b3J5KCkgKSB7XG5cdGxvZ2dlci5lcnJvciggYCR7YWJzb2x1dGVQYXRofSBpcyBub3QgYSBkaXJlY3RvcnkuIFBsZWFzZSBwcm92aWRlIGEgZGlyZWN0b3J5YCApO1xuXHRwcm9jZXNzLmV4aXQoIDEgKTtcbn0gZWxzZSB7XG5cdGxvZ2dlci5pbmZvKCBgUHJvY2Vzc2luZyBkaXJlY3Rvcnk6ICcke2Fic29sdXRlUGF0aH0nYCApO1xufVxuXG5cbmNvbnZlcnRKc1RvVHNTeW5jKCBhYnNvbHV0ZVBhdGgsIHtcblx0aW5kZW50YXRpb25UZXh0OiByZXNvbHZlSW5kZW50YXRpb25UZXh0KCBhcmdzLmluZGVudGF0aW9uX3RleHQgKSxcblx0bG9nTGV2ZWw6IHJlc29sdmVMb2dMZXZlbCggYXJncy5sb2dfbGV2ZWwgKSxcblx0aW5jbHVkZVBhdHRlcm5zOiBwYXJzZUluY2x1ZGVQYXR0ZXJucyggYXJncy5pbmNsdWRlICksXG5cdGV4Y2x1ZGVQYXR0ZXJuczogcGFyc2VFeGNsdWRlUGF0dGVybnMoIGFyZ3MuZXhjbHVkZSApXG59ICk7XG5cblxuLyoqXG4gKiBQcml2YXRlIGhlbHBlciB0byByZXNvbHZlIHRoZSBjb3JyZWN0IEluZGVudGF0aW9uVGV4dCBlbnVtIGZyb20gdGhlIENMSVxuICogJ2luZGVudGF0aW9uJyBhcmd1bWVudC5cbiAqL1xuZnVuY3Rpb24gcmVzb2x2ZUluZGVudGF0aW9uVGV4dCggaW5kZW50YXRpb25UZXh0OiAndGFiJyB8ICd0d29zcGFjZXMnIHwgJ2ZvdXJzcGFjZXMnIHwgJ2VpZ2h0c3BhY2VzJyApIHtcblx0c3dpdGNoKCBpbmRlbnRhdGlvblRleHQgKSB7XG5cdFx0Y2FzZSAndGFiJyAgICAgICAgIDogcmV0dXJuIEluZGVudGF0aW9uVGV4dC5UYWI7XG5cdFx0Y2FzZSAndHdvc3BhY2VzJyAgIDogcmV0dXJuIEluZGVudGF0aW9uVGV4dC5Ud29TcGFjZXM7XG5cdFx0Y2FzZSAnZm91cnNwYWNlcycgIDogcmV0dXJuIEluZGVudGF0aW9uVGV4dC5Gb3VyU3BhY2VzO1xuXHRcdGNhc2UgJ2VpZ2h0c3BhY2VzJyA6IHJldHVybiBJbmRlbnRhdGlvblRleHQuRWlnaHRTcGFjZXM7XG5cblx0XHRkZWZhdWx0IDogcmV0dXJuIEluZGVudGF0aW9uVGV4dC5UYWI7XG5cdH1cbn1cblxuXG5mdW5jdGlvbiByZXNvbHZlTG9nTGV2ZWwoIGxvZ0xldmVsU3RyOiBzdHJpbmcgKTogTG9nTGV2ZWwge1xuXHRpZiggIWxvZ0xldmVscy5pbmNsdWRlcyggbG9nTGV2ZWxTdHIgKSApIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIGBcblx0XHRcdFVua25vd24gLS1sb2ctbGV2ZWwgYXJndW1lbnQgJyR7bG9nTGV2ZWxTdHJ9J1xuXHRcdFx0TXVzdCBiZSBvbmUgb2Y6ICcke2xvZ0xldmVscy5qb2luKCBcIicsICdcIiApfSdcblx0XHRgLnRyaW0oKS5yZXBsYWNlKCAvXFx0Ki9nbSwgJycgKSApO1xuXHR9XG5cblx0cmV0dXJuIGxvZ0xldmVsU3RyIGFzIExvZ0xldmVsO1xufVxuXG5cbmZ1bmN0aW9uIHBhcnNlSW5jbHVkZVBhdHRlcm5zKCBpbmNsdWRlUGF0dGVybnM6IHN0cmluZyB8IHVuZGVmaW5lZCApOiBzdHJpbmdbXSB8IHVuZGVmaW5lZCB7XG5cdGlmKCAhaW5jbHVkZVBhdHRlcm5zICkgeyByZXR1cm4gdW5kZWZpbmVkOyB9ICAvLyByZXR1cm4gdW5kZWZpbmVkIHRvIHVzZSB0aGUgZGVmYXVsdFxuXG5cdHJldHVybiBpbmNsdWRlUGF0dGVybnMuc3BsaXQoICcsJyApO1xufVxuXG5mdW5jdGlvbiBwYXJzZUV4Y2x1ZGVQYXR0ZXJucyggZXhjbHVkZVBhdHRlcm5zOiBzdHJpbmcgfCB1bmRlZmluZWQgKTogc3RyaW5nW10ge1xuXHRpZiggIWV4Y2x1ZGVQYXR0ZXJucyApIHsgcmV0dXJuIFtdOyB9XG5cblx0cmV0dXJuIGV4Y2x1ZGVQYXR0ZXJucy5zcGxpdCggJywnICk7XG59Il19